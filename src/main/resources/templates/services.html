<!DOCTYPE html>
<html lang="ar" dir="rtl" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>الخدمات</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      flex-direction: column;
    }
    .app-header { background-color: #3f51b5; box-shadow: 0 2px 10px rgba(0,0,0,0.2); padding:1rem 0; margin-bottom:2rem; }
    .card { border:none; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.12); background: rgba(255,255,255,0.95); }
    .service-img { height:180px; object-fit:cover; border-top-left-radius:12px; border-top-right-radius:12px; }
    .app-footer { background-color: rgba(0,0,0,0.2); border-top:1px solid rgba(255,255,255,0.1); color: rgba(255,255,255,0.8); padding-top:2rem !important; margin-top:auto; }
    .search-box { max-width:480px; margin:auto 0; }
  </style>
</head>
<body class="d-flex flex-column min-vh-100">

  <!-- HEADER (انسخه كما هو في صفحاتك الأخرى) -->
  <header class="app-header">
    <div class="container d-flex justify-content-between align-items-center">
      <h3 class="m-0 text-white">
        <img th:src="@{/img/logo.jpg}" src="/img/logo.jpg" alt="شعار المغسلة" class="logo-img" style="height:42px;">
      </h3>

      <nav class="d-flex align-items-center">
        <a th:href="@{/home}" class="text-white mx-3 text-decoration-none">الرئيسية</a>
        <a th:href="@{/services}" class="text-white mx-3 text-decoration-none">الخدمات</a>
        <a th:href="@{/orders}" class="text-white mx-3 text-decoration-none" id="nav-orders-link">طلباتي</a>
        <a th:href="@{/about}" class="text-white mx-3 text-decoration-none">من نحن</a>

        <!-- مكان تغيير حالة التسجيل -->
        <div id="nav-auth" class="ms-3"></div>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main class="flex-grow-1">
    <section class="container my-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-white">الخدمات المتاحة</h2>

        <div class="search-box">
          <input id="searchInput" class="form-control" placeholder="ابحث عن خدمة...">
        </div>
      </div>

      <div id="servicesGrid" class="row g-4">
        <!-- البطاقات ستُملأ ديناميكياً -->
      </div>

      <div id="noServices" class="text-center text-white mt-4" style="display:none;">
        لا توجد خدمات حالياً.
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="app-footer pt-5 pb-3 mt-auto">
    <div class="container">
      <div class="row">
        <div class="col-md-4 mb-4">
          <h5>نظام إدارة المغاسل</h5>
          <p class="small">تطبيق لإدارة طلبات المغاسل بشكل سهل وسريع.</p>
        </div>
        <div class="col-md-4 mb-4">
          <h5>روابط</h5>
          <ul class="list-unstyled small">
            <li><a href="/home.html">الرئيسية</a></li>
            <li><a href="/services.html">الخدمات</a></li>
            <li><a href="/about.html">من نحن</a></li>
          </ul>
        </div>
        <div class="col-md-4 mb-4">
          <h5>تواصل</h5>
          <ul class="list-unstyled small">
            <li><i class="fas fa-envelope me-2"></i> info@laundryapp.com</li>
            <li><i class="fas fa-phone me-2"></i> +966 50 XXX XXXX</li>
          </ul>
        </div>
      </div>

      <hr class="mt-2 mb-3" style="border-color: rgba(255,255,255,0.3);">

      <div class="row">
        <div class="col-12 text-center small text-white">
          &copy; <span th:text="${#dates.format(#dates.createNow(),'yyyy')}">2025</span> جميع الحقوق محفوظة.
        </div>
      </div>
    </div>
  </footer>

  <!-- SCRIPTS -->
  <script>
    // ---------- 1) renderHeader: يغير زر التسجيل إلى أيقونة البروفايل لو موجود user ----------
    function renderHeader() {
      const navAuth = document.getElementById('nav-auth');
      const userJson = localStorage.getItem('laundry_user');
      if (!navAuth) return;

      if (userJson) {
        const user = JSON.parse(userJson);
        navAuth.innerHTML = `
          <div class="dropdown">
            <a class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" href="#" id="profileMenu" data-bs-toggle="dropdown" aria-expanded="false">
              <img src="/img/profile.png" class="rounded-circle" width="38" height="38" alt="avatar">
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileMenu">
              <li><a class="dropdown-item" href="/profile.html">الملف الشخصي</a></li>
              <li><a class="dropdown-item" href="#" id="logoutBtn">تسجيل الخروج</a></li>
            </ul>
          </div>
        `;
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) logoutBtn.addEventListener('click', () => {
          localStorage.removeItem('laundry_user');
          window.location.reload();
        });
        // إظهار رابط الطلبات لأن المستخدم مسجل
        document.getElementById('nav-orders-link').style.display = 'inline-block';
      } else {
        navAuth.innerHTML = `
          <a href="/login.html" class="btn btn-light btn-sm mx-2">تسجيل الدخول</a>
          <a href="/register.html" class="btn btn-outline-light btn-sm">إنشاء حساب</a>
        `;
        // إخفاء رابط الطلبات للضيف
        document.getElementById('nav-orders-link').style.display = 'none';
      }
    }

    document.addEventListener('DOMContentLoaded', renderHeader);

    // ---------- 2) تحميل الخدمات من الباك اند ----------
    async function loadServices() {
      try {
        const res = await fetch('http://localhost:8080/api/services');
        if (!res.ok) throw new Error('فشل جلب الخدمات');
        const services = await res.json();
        renderServices(services);
      } catch (err) {
        console.error(err);
        document.getElementById('noServices').style.display = 'block';
      }
    }

    // ---------- 3) عرض الخدمات كبطاقات ----------
    function renderServices(services) {
      const grid = document.getElementById('servicesGrid');
      grid.innerHTML = '';
      if (!services || services.length === 0) {
        document.getElementById('noServices').style.display = 'block';
        return;
      }
      document.getElementById('noServices').style.display = 'none';

      services.forEach(s => {
        const col = document.createElement('div');
        col.className = 'col-12 col-sm-6 col-md-4';
        col.innerHTML = `
          <div class="card h-100">
            <img src="/img/service-${s.id}.jpg" onerror="this.src='/img/default-service.jpg'" class="service-img w-100" alt="${s.name}">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">${s.name}</h5>
              <p class="card-text text-muted" style="flex:1">${s.description ? s.description : ''}</p>
              <div class="d-flex justify-content-between align-items-center mt-3">
                <div class="fw-bold">${s.price} ر.س</div>
                <a href="/service_detail.html?id=${s.id}" class="btn btn-primary btn-sm">تفاصيل</a>
              </div>
            </div>
          </div>
        `;
        grid.appendChild(col);
      });
    }

    // ---------- 4) بحث محلي على الخدمات ----------
    document.addEventListener('DOMContentLoaded', () => {
      const input = document.getElementById('searchInput');
      input.addEventListener('input', () => {
        const q = input.value.trim().toLowerCase();
        const cards = Array.from(document.querySelectorAll('#servicesGrid .card'));
        cards.forEach(card => {
          const title = card.querySelector('.card-title').innerText.toLowerCase();
          const desc = card.querySelector('.card-text').innerText.toLowerCase();
          card.parentElement.style.display = (title.includes(q) || desc.includes(q)) ? 'block' : 'none';
        });
      });

      // أخيراً: نحمّل الخدمات
      loadServices();
    });
  </script>

</body>
</html>
